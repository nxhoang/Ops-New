function toggleField(){$(`#spExpandField`).toggleClass("glyphicon glyphicon-chevron-right glyphicon glyphicon-chevron-down")}function ChangeMode(){let n="",t="";switch(SubmitMode){case NavMode.Create:n="Creating New Table";t="Create";document.getElementById("divSelectedLine").style.display="none";document.getElementById("txtSeletedLine").style.display="block";setDefaultValues(1,8,5,550,60,50,192);break;case NavMode.Update:n="Updating Table";t="Update";document.getElementById("txtSeletedLine").style.display="none";document.getElementById("divSelectedLine").style.display="block"}document.getElementById("titleTableModal").innerHTML=n;document.getElementById("btnSubmitFormTable").innerHTML=t}function setDefaultValues(n,t,i,r,u,f,e){$("input[name=seatType][value="+n+"]").prop("checked",!0);document.getElementById("seatTotal").value=t;document.getElementById("seatDis").value=i;document.getElementById("tableWidth").value=r;document.getElementById("tableLength").value=u;document.getElementById("txtDisplayLength").value=f;document.getElementById("txtDisplayWidth").value=e}function SetValuesForTableForm(n){const t=GetSelectedOptions(CbLineId)[0],i=t===null||t===undefined?n.LineSerial:t.value;$(CbLineId).multiselect("deselect",i);$(CbLineId).multiselect("select",[n.LineSerial]);document.getElementById("txtSeletedLine").value=n.name;setDefaultValues(n.SeatType,n.TotalSeat,parseInt(n.SeatDistance),parseInt(n.ActualWidth),parseInt(n.ActualLength),parseInt(n.VirtualLength),parseInt(n.VirtualWidth))}function getMsgByLang(n){const t=$("#flagSelected").attr("value");return GetMsgByLang(n,t)}var msgSave,msgError;const ModalTable=$(ModalTableId);(()=>{function p(){return[{background:"transparent"},{layerName:"Background"},{locationSpot:go.Spot.Center,locationObjectName:"TABLESHAPE"},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),{rotatable:!0},new go.Binding("angle").makeTwoWay(),{mouseDragEnter:function(n,t){e(t,t.diagram.selection,!0)},mouseDragLeave:function(n,t){e(t,t.diagram.selection,!1)},mouseDrop:function(n,t){l(t,t.diagram.selection,n.documentPoint)},doubleClick:(n,t)=>{window.SubmitMode=NavMode.Update,u=t.data,SetValuesForTableForm(t.data),ModalTable.modal("show")}}]}function r(n,i,r,u){return(u===null||u===undefined)&&(u="burlywood"),typeof i=="string"&&(i=go.Spot.parse(i)),i&&i.isSpot()||(i=go.Spot.Right),typeof r=="string"&&(r=go.Spot.parse(r)),r&&r.isSpot()||(r=i.opposite()),t(go.Panel,"Spot",{name:n.toString(),alignment:i,alignmentFocus:r},t(go.Shape,TableShape.Square,{name:"SEATSHAPE",desiredSize:new go.Size(SeatSize,SeatSize),fill:u,stroke:"white",strokeWidth:2},new go.Binding("fill")),t(go.TextBlock,n.toString(),{font:"10pt Verdana, sans-serif"},new go.Binding("angle","angle",function(n){return-n})))}function w(){n=t(go.Diagram,"facDiagramDiv",{allowDragOut:!0,allowDrop:!0,allowClipboard:!1,initialContentAlignment:go.Spot.Center,draggingTool:t(h),rotatingTool:t(c),ModelChanged:function(n){n.isTransactionFinished},"undoManager.isEnabled":!0});n.nodeTemplateMap.add("",t(go.Node,"Auto",{background:"transparent"},new go.Binding("layerName","isSelected",function(n){return n?"Foreground":""}).ofObject(),{locationSpot:go.Spot.Center},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("text","key"),{mouseDragEnter:function(n,t){e(t,t.diagram.selection,!0)},mouseDragLeave:function(n,t){e(t,t.diagram.selection,!1)},mouseDrop:function(n,t){l(t,t.diagram.selection,n.documentPoint)}},t(go.Shape,"Rectangle",{fill:"blanchedalmond",stroke:null}),t(go.Panel,"Viewbox",{desiredSize:new go.Size(100,150)},t(go.TextBlock,{margin:2,desiredSize:new go.Size(100,150),font:"11pt Verdana, sans-serif",textAlign:"start",stroke:"red"},new go.Binding("text","",function(n){var t=n.key;return n.plus&&(t+=" +"+n.plus.toString()),t})))));n.mouseDrop=function(n){n.diagram.selection.each(function(n){i(n)&&o(n.data)});document.getElementById("btnSaveChanges").disabled=!1};n.addDiagramListener("PartRotated",function(){document.getElementById("btnSaveChanges").disabled=!1});var r=t(go.Diagram,"facWorkerDiv",{layout:t(go.GridLayout,{sorting:go.GridLayout.Ascending}),allowDragOut:!0,allowDrop:!0});n.addDiagramListener("ExternalObjectsDropped",function(n){n.subject.any(f)||r.commandHandler.deleteSelection()});n.addDiagramListener("SelectionDeleted",function(t){n.disableSelectionDeleted||t.subject.each(function(n){i(n)&&r.model.addNodeData(r.model.copyNodeData(n.data))})});r.nodeTemplateMap=n.nodeTemplateMap;r.model=new go.GraphLinksModel([{key:"Jon Snow"},{key:"Stannis Baratheon"}]);r.model.undoManager=n.model.undoManager;r.addDiagramListener("ExternalObjectsDropped",function(t){if(t.subject.any(f)){n.currentTool.doCancel();r.currentTool.doCancel();return}n.selection.each(function(n){i(n)&&o(n.data)});n.disableSelectionDeleted=!0;n.commandHandler.deleteSelection();n.disableSelectionDeleted=!1;r.selection.each(function(n){i(n)&&o(n.data)})})}function i(n){return n!==null&&n!==undefined&&n.category===""}function f(n){return n!==null&&n!==undefined&&n.category!==""}function e(n,t,r){var s,e,u,h,o;if((!i(n)||(n=n.diagram.findNodeForKey(n.data.table),n!==null))&&!t.any(f)&&n!==null&&n!==undefined)for(s=n.data.guests,e=n.elements;e.next();)if(u=e.value,u.name){if(h=parseFloat(u.name),isNaN(h))continue;if(o=u.findObject("SEATSHAPE"),!o)continue;o.stroke=r?s[u.name]?"red":"green":"white"}}function l(t,r,u){if(!i(t)||(t=t.diagram.findNodeForKey(t.data.table),t!==null)){if(r.any(f)){n.currentTool.doCancel();return}r.each(function(n){a(t,n.data,u)});v(t)}}function a(n,t,r){var s,h,f;if(!i(n)||(n=n.diagram.findNodeForKey(n.data.table),n!==null)){if(t instanceof go.GraphObject)throw Error("A guest object must not be a GraphObject: "+t.toString());if(r instanceof go.Point||!n||(r=n.location),o(t),n!==null&&n!==undefined){var u=n.diagram.model,c=n.data.guests,e=b(n,r);if(e&&(u.setDataProperty(c,e,t.key),u.setDataProperty(t,"table",n.data.key),u.setDataProperty(t,"seat",parseFloat(e))),s=t.plus,s)for(t.plus=undefined,u.updateTargetBindings(t),h=0;h<s;h++)f=u.copyNodeData(t),f.table=undefined,f.seat=undefined,u.addNodeData(f),a(n,f,r)}}}function o(t){var i,r,u;if(t instanceof go.GraphObject)throw Error("A guest object must not be a GraphObject: "+t.toString());i=n.model;t.table&&(r=i.findNodeDataForKey(t.table),r&&(u=r.guests,u&&i.setDataProperty(u,t.seat.toString(),undefined)));i.setDataProperty(t,"table",undefined);i.setDataProperty(t,"seat",undefined)}function b(n,t){var u,r,s,h,f;i(n)&&(n=n.diagram.findNodeForKey(n.data.table));var c=n.data.guests,e=null,o=Infinity;for(u=n.elements;u.next();)if(r=u.value,r.name){if(s=parseFloat(r.name),isNaN(s))continue;if(c[r.name])continue;h=r.getDocumentPoint(go.Spot.Center);f=h.distanceSquaredPoint(t);f<o&&(o=f,e=r.name)}return e}function v(n){var t,u,r,f,e;if((!i(n)||(n=n.diagram.findNodeForKey(n.data.table),n!==null))&&n!==null&&n!==undefined){t=n.data.guests;u=n.diagram.model;for(r in t)t.hasOwnProperty(r)&&(f=t[r],e=u.findNodeDataForKey(f),k(e))}}function k(t){var f,e;if(t instanceof go.GraphObject)throw Error("A guest object must not be a GraphObject: "+t.toString());if(t&&t.table&&t.seat){var i=n,r=i.findPartForKey(t.table),u=i.findPartForData(t);r&&u&&(f=r.findObject(t.seat.toString()),e=f.getDocumentPoint(go.Spot.Center),u.location=e)}}function h(){go.DraggingTool.call(this);this.isCopyEnabled=!1}function c(){go.RotatingTool.call(this)}function d(n,t,i,u,f){var e=[],s,h,o,c,l,a;if(n>0){let v=t,w=0,y=0,p=0;switch(i){case"1":case"2":s=1;h=0;i==="2"&&(s=0,h=1);for(let i=1;i<=n;i++)i%2==0?(e.push(r(i,new go.Spot(v,s,y,p),go.Spot.Center,f)),v=v+t,y=y+u):e.push(r(i,new go.Spot(v,h,y,p),go.Spot.Center,f));break;case"3":case"4":i==="3"&&(w=1);for(let i=1;i<=n;i++)e.push(r(i,new go.Spot(v,w,y,p),go.Spot.Center,f)),v=v+t,y=y+u;break;case"5":case"6":i==="5"&&(w=1);for(let i=1;i<=n;i++){let n=i;i>1&&(n=i+(i-1));e.push(r(n,new go.Spot(v,w,y,p),go.Spot.Center,f));v=v+t;y=y+u}break;case"7":case"8":i==="7"&&(w=1);for(let i=1;i<=n;i++){let n=i+i;e.push(r(n,new go.Spot(v,w,y,p),go.Spot.Center,f));v=v+t;y=y+u}break;case"9":case"10":o=1;c=0;i==="10"&&(o=0,c=1);for(let i=1;i<=n;i++)i===1&&(e.push(r(i,new go.Spot(v,o,y,p),go.Spot.Center,f)),v=v+t,y=y+u),i%2==0?e.push(r(i,new go.Spot(v,o,y,p),go.Spot.Center,f)):i!==1&&(e.push(r(i,new go.Spot(v,c,y,p),go.Spot.Center,f)),v=v+t,y=y+u);break;case"11":case"12":l=1;a=0;i==="12"&&(l=0,a=1);for(let i=1;i<=n;i++)i%2==0?e.push(r(i,new go.Spot(v,l,y,p),go.Spot.Center,f)):(e.push(r(i,new go.Spot(v,a,y,p),go.Spot.Center,f)),v=v+t,y=y+u)}}return e}function g(n){$.blockUI();$.post(UriApiTableSpace,n).done(t=>{if(t===null||t===undefined)MsgInform("Inform","Could not add the Table space","error",!1,!0);else{s(t.TableId,t.TableName,t.TbLocation,t.Angle,t.VirtualWidth,t.VirtualLength,t.ActualWidth,t.ActualLength,t.SeatTotal,t.SeatType.toString(),t.SeatDistance,t.BackgroundColor,t.Workers,t.LineSerial,t.Rate);LastSelectedFactoryId&&getMesLineByFactory(LastSelectedFactoryId);ModalTable.modal("hide");n.TableId=t.TableId;const i=GetSelectedOptions(CbCorporation)[0];getFactoriesByCorporation(UriApiFactory,i.value,SelectedDatabase);nt(n)}}).always(()=>{$.unblockUI()})}function nt(n){$.post(UriApiOracleTbsp,n).done(n=>{n===null||n===undefined?console.log("Could not add the Table space to PKMES."):console.log("Added successfully the Table space to PKMES.")})}function tt(){$("#tableForm").submit(function(n){var t,h;if(LastSelectedFactoryId===null||LastSelectedFactoryId===undefined){MsgInform("Inform","Please select a Factory","error",!1,!0);return}const r=document.getElementById("seatTotal"),f=document.getElementById("seatDis"),c=document.getElementById("tableWidth"),l=document.getElementById("tableLength"),i=getSelectedRadioByName("seatType"),e=document.getElementById("txtDisplayWidth"),o=document.getElementById("txtDisplayLength");if(validateNumber(r)&&validateNumber(f)&&i&&i.value&&validateNumber(e)&&validateNumber(o)){const y=parseInt(r.value),p=parseFloat(c.value),w=parseFloat(l.value),b=parseInt(f.value),k=parseFloat(e.value),d=parseFloat(o.value),nt=document.getElementById("txtSeletedLine").value,n=new TableSpace(null,nt,TbLocation,0,k,d,y,i.value,b,null,null,LastSelectedFactoryId,null,TableTypes.TableOO,p,w,null);switch(SubmitMode){case NavMode.Create:var a=$(LineMesGrid).jqGrid("getGridParam","selrow"),s=$(LineMesGrid).jqGrid("getRowData",a),v=s.BackgroundColor.substr(51,7);n.BackgroundColor=v;n.LineSerial=s.LineSerial;g(n);break;case NavMode.Update:t=GetSelectedOptions(CbLineId)[0];h=t.title;n.LineSerial=t.value;n.BackgroundColor=h;n.TableId=u.key;n.Angle=u.angle;n.TbLocation=u.loc;n.TableName=t.text;yt(n)}}n.preventDefault()})}function s(i,r,u,f,e,o,s,h,c,l,a,v,y,w,b){const k=35/e;n.nodeTemplateMap.add(TableTypes.TableOO,t(go.Node,"Spot",p(),t(go.Panel,"Spot",t(go.Shape,TableShape.Rectangle,{name:"TABLESHAPE",desiredSize:new go.Size(e,o),fill:v,stroke:null},new go.Binding("desiredSize","size",go.Size.parse).makeTwoWay(go.Size.stringify),new go.Binding("fill")),t(go.TextBlock,{editable:!0,font:"bold 11pt Verdana, sans-serif"},new go.Binding("text","name").makeTwoWay())),d(c,k,l,a,v)));y=y===null||y===undefined?{}:y;const g={key:i,category:TableTypes.TableOO,name:r,guests:y,loc:u,angle:f,VirtualWidth:e,VirtualLength:o,ActualWidth:s,ActualLength:h,TotalSeat:c,SeatType:l,SeatDistance:a,BackgroundColor:v,LineSerial:w,Rate:b};n.startTransaction("Begin adding table transaction");n.model.addNodeData(g);n.commitTransaction("Commit adding table transaction")}function it(){const t=n.selection.first();if(t===null||t===undefined){MsgInform("Inform","Please select a table","error",!1,!0);return}ConfirmYesNo("Confirmation","Are you sure to delete?",()=>{const n=t.data.key;rt(n);ut(n)})}function rt(t){$.blockUI();$.post("/Factory/MySqlDeleteTable",{tableId:t}).done(t=>{if(t.error===null||t.error===undefined){const i=t.result;if(i!=="false"){n.allowDelete=!0;n.commandHandler.deleteSelection();n.allowDelete=!1;LastSelectedFactoryId&&getMesLineByFactory(LastSelectedFactoryId);const t=GetSelectedOptions(CbCorporation)[0];getFactoriesByCorporation(UriApiFactory,t.value,SelectedDatabase)}else console.log("An error occurred, could not delete the table.")}else console.log(t.error)}).always(()=>{$.unblockUI()})}function ut(n){$.post("/Factory/OracleDeleteTable",{tableId:n}).done(n=>{if(n.error===null||n.error===undefined){const t=n.result;t!=="false"?console.log("Delete successfully the table in PKMES."):console.log("An error occurred, could not delete the table in PKMES.")}else console.log(n.error)})}function y(t){const r=n.selection.first();if(r===null||r===undefined){MsgInform("Inform","Please select a table","error",!1,!0);return}const i=r.data,u=t==="add"?parseInt(i.TotalSeat)+1:parseInt(i.TotalSeat)-1,f=CalculateTableWidth(u,i.SeatDistance,i.SeatType),e=new TableSpace(i.key,i.name,i.loc,i.angle,f,i.VirtualLength,u,i.SeatType.toString(),i.SeatDistance,i.BackgroundColor,null,null,i.LineSerial,i.category,i.ActualWidth,i.ActualLength,i.Rate);ft(e,t)}function ft(n,t){et(n,t)}function et(t,i){$.blockUI();$.post("/Factory/MySqlUpdateSeat",{table:t,action:i}).done(r=>{if(r.error===null||r.error===undefined){const u=r.result;u===!0?(n.allowDelete=!0,n.commandHandler.deleteSelection(),n.allowDelete=!1,s(t.TableId,t.TableName,t.TbLocation,t.Angle,t.VirtualWidth,t.VirtualLength,t.ActualWidth,t.ActualLength,t.SeatTotal,t.SeatType.toString(),t.SeatDistance,t.BackgroundColor,t.Workers,t.LineSerial,t.Rate),ot(t,i)):console.log("An error occurred, could not add a seat to the table.")}else console.log(r.error)}).always(()=>{$.unblockUI()})}function ot(n,t){const i=new AjaxConfig("/Factory/OracleUpdateSeat",!0,JSON.stringify({table:n,action:t}));AjaxPostCommon(i,n=>{if(n.error===null||n.error===undefined){const t=n.result;t===!0?console.log("Updated successfully a seat to the table in PKMES."):console.log("An error occurred, could not add a seat to the table in PKMES.")}else console.log(n.error)})}function st(n){return n?n.hasOwnProperty("category")?new TableSpace(n.key,n.name,n.loc,n.angle,null,null,null,null,null,null,n.guests,null,null,n.category,null,null,null):null:null}function ht(){const i=JSON.parse(n.model.toJson()).nodeDataArray,t=[];for(let n of i){const i=st(n);i!==null&&t.push(i)}ct({tbsps:t})}function ct(n){$.blockUI();$.post(MsqlFacSaveChanges,n).done(t=>{if(t.error===null||t.error===undefined)if(t===!0){const t=getMsgByLang(msgSave);MsgInform(t.title,t.value,ObjMessageType.Info,!1,!0);lt(n)}else{const n=getMsgByLang(msgError);ShowMessage(n.title,n.value,ObjMessageType.Error)}else console.log(t.error)}).always(()=>{$.unblockUI()})}function lt(n){$.post(OraFacSaveChanges,n).done(n=>{n.error===null||n.error===undefined?n===!0?console.log("Saved successfully changes in PKMES"):console.log("Failed saving changes in PKMES"):console.log(n.error)})}function at(){y("add")}function vt(){y("del")}function yt(t){$.blockUI();$.post("/Factory/MySqlUpdateTable",t).done(i=>{if(i.error===null||i.error===undefined){const r=i.result;r!==!1?(n.allowDelete=!0,n.commandHandler.deleteSelection(),n.allowDelete=!1,s(t.TableId,t.TableName,t.TbLocation,t.Angle,t.VirtualWidth,t.VirtualLength,t.ActualWidth,t.ActualLength,t.SeatTotal,t.SeatType.toString(),t.SeatDistance,t.BackgroundColor,t.Workers,t.LineSerial,t.Rate),LastSelectedFactoryId&&getMesLineByFactory(LastSelectedFactoryId),ModalTable.modal("hide"),pt(t)):console.log("Could not update the table.")}else console.log(i.error)}).always(()=>{$.unblockUI()})}function pt(n){$.post("/Factory/OracleUpdateTable",n).done(n=>{if(n.error===null||n.error===undefined){const t=n.result;t!==!1?console.log("Updated succesfully the table to PKMES db."):console.log("Could not update the table to PKMES db.")}else console.log(n.error)})}GetMessageById("001",SystemIdOps,MenuIdOpm,SmsFunction.Add,MessageType.Success,MessageContext.Update,n=>{msgSave=n});GetMessageById("002",SystemIdOps,MenuIdAom,SmsFunction.Generic,MessageType.Error,MessageContext.Error,n=>{msgError=n});var t=go.GraphObject.make,n;let u;ModalTable.on("shown.bs.modal",()=>{ChangeMode()});go.Diagram.inherit(h,go.DraggingTool);h.prototype.computeEffectiveCollection=function(n){var t=go.DraggingTool.prototype.computeEffectiveCollection.call(this,n);return n.each(function(n){var u,r;if(!i(n))for(u=n.diagram.nodes;u.next();)r=u.value,i(r)&&r.data.table===n.data.key&&(t.contains(r)||t.add(r,{point:r.location.copy()}))}),t};go.Diagram.inherit(c,go.RotatingTool);c.prototype.rotate=function(n){go.RotatingTool.prototype.rotate.call(this,n);var t=this.adornedObject.part;v(t)};w();window.GetTbspByFactory=function(t){if(n.clear(),t!==null&&t!==undefined){const i=`${UriApiTableSpace}/?factory=${t}`;$.blockUI();$.getJSON(i).done(function(n){n&&n.forEach(n=>{s(n.TableId,n.TableName,n.TbLocation,n.Angle,n.VirtualWidth,n.VirtualLength,n.ActualWidth,n.ActualLength,n.SeatTotal,n.SeatType.toString(),n.SeatDistance,n.BackgroundColor,n.Workers,n.LineSerial,n.Rate)})}).always(()=>{$.unblockUI()})}};tt();window.HideTableByLine=function(t){for(const i=n.nodes.iterator;i.next();)n.startTransaction("Begin visible tables transaction"),i.value.visible=i.value.data.LineSerial.toString()!==t?!1:!0,n.commitTransaction("Commit visible tables transaction")};document.getElementById("btnDelTable").addEventListener("click",it);document.getElementById("btnSaveChanges").addEventListener("click",ht);document.getElementById("btnAddSeat").addEventListener("click",at);document.getElementById("btnRemoveSeat").addEventListener("click",vt);document.getElementById("aExpandField").addEventListener("click",toggleField)})();