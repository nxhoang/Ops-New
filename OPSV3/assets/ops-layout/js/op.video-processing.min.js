function SaveProcessVideo1(){const n=_videoOpdts1.filter(n=>n.OpSerial&&n.OpSerial!=="0");console.log(n);n&&n.length>0?UploadMainVideoToServer1():MsgInform("Information","There are not any processes that are assigned to videos.","error",!1,!0)}function SplitVideoOp1(n,t){const i=_videoOpdts1.filter(n=>n.OpSerial&&n.OpSerial!=="0"),r=new AjaxConfig(UrlSplitOpdtVideos1,!0,JSON.stringify({opdtVideos:i,inputFilePath:n,connectionId:t}));return AjaxPostCommon(r,n=>{if(console.log(n),n.IsSuccess===!1)MsgInform("Error","An error occured, please try again or contact admin.","error",!1,!0);else{for(var t of n){const n=toolkit.getNode(t.Result.OpSerial);n.data.ShowButtonPlayVideo=!0;toolkit.updateNode(n)}document.getElementById(DivGlobe1).style.display="none"}})}function SendCroppedOpdtVideoInfo1(n,t){const i=_videoOpdts1.filter(n=>n.OpSerial&&n.OpSerial!=="0");return $.post(UrlSplitOpdtVideos1,{opdtVideos:i,inputFilePath:n,connectionId:t}).done(n=>{if(console.log(n),n.IsSuccess===!1)MsgInform("Error","An error occured, please try again or contact admin.","error",!1,!0);else{for(var t of n){const n=toolkit.getNode(t.Result.OpSerial);n.data.ShowButtonPlayVideo=!0;toolkit.updateNode(n)}document.getElementById(DivGlobe1).style.display="none"}}).fail((n,t,i)=>{HandleException(n,t,i)})}function UploadMainVideoToServer1(){const t=uuidv4(),n=$("#inputUploadVideo1")[0].files;if(n.length===0)console.log("No file to upload");else{const r=n[0],u=[],s=3145728,i=GetSelectedOneRowData(gridOpsTableId);let f=0,e=s;const l=r.size;while(f<l)u.push(r.slice(f,e)),f=e,e=f+s;const a=u.length,h=[];let c=0,v=[],o;$.blockUI({fadeIn:1e3,message:"<h3>Uploading video to the server...<\/h3>",onBlock:()=>{while(u.length>0){c++;const f=u.shift(),e=r.name+".part_"+c+"."+a,n=new FormData;n.append(r.name,f);n.append("FileName",r.name);n.append("FilePartName",e);n.append("guid",t);n.append("Edition",i.Edition2);n.append("StyleCode",i.StyleCode);n.append("StyleSize",i.StyleSize);n.append("StyleColorSerial",i.StyleColorSerial);n.append("RevNo",i.RevNo);n.append("OpRevNo",i.OpRevNo);const s=UploadChunkFile1(n,n=>{console.log(n),v.push(n),n&&n.IsSuccess&&n.Result&&(console.log("Done uploading video and file is merged."),console.log(n.Result),o=n.Result)});h.push(s)}$.when.apply($,h).done(()=>{if($.unblockUI(),console.log("All threads completed"),MsgInform("Information","Splitting video...\n We will notify once finish.","info",!1,!0),document.getElementById(DivGlobe1).style.display="block",o){const n=$.connection.opsVideoHub;console.log(n);n.client.sendMessage=(n,t)=>{console.log(n);console.log(`Number of video: ${t}`);const u=document.getElementById("vdpAlerts"),r=createAlertTag1(n);u.appendChild(r);setTimeout(()=>{r.remove()},5e3);document.getElementById(DivProgressBarWrapper).style.display="block";const i=t/_videoOpdts1.filter(n=>n.OpSerial!==null).length*100;document.getElementById(DivProgressBar).style.width=`${i.toFixed(2)}%`;document.getElementById(DivProgressBar).innerHTML=`${i.toFixed(2)}%`;i===100&&setTimeout(()=>{document.getElementById(DivProgressBarWrapper).style.display="none"},3e3)};$.connection.hub.start().done(()=>{console.log("SignalR is started."),n.server.getConnectionId().done(n=>{SplitVideoOp1(o,n)})})}})}})}}function UploadChunkFile1(n,t){return $.ajax({url:UrlUploadChunkVideos1,async:!0,type:"POST",data:n,contentType:!1,processData:!1,success:n=>{t(n)},beforeSend:()=>{},complete:()=>{},error:n=>{console.log(n)}})}function createProcessDropdownList1(n,t){const r=document.createElement("select"),u=document.createElement("option");u.setAttribute("value",0);u.innerHTML="Select process!";r.appendChild(u);r.id=`selP${t}`;for(var i of n){const n=document.createElement("option"),t=i.OpNameLan?i.OpNameLan:i.OpName,u=i.OpNum?`[${i.OpNum}]`:"[]";n.setAttribute("value",i.OpSerial);n.innerHTML=`${u} ${t}`;r.appendChild(n)}return r}function createRightVideoList1(n){const r=document.createElement("div"),f=document.createElement("div"),u=document.createElement("div"),s=document.createElement("div"),h=document.createElement("div"),c=document.createElement("div"),e=document.createElement("div"),l=document.createElement("span"),t=document.createElement("video"),o=document.createElement("button"),p=document.createElement("span"),a=document.createElement("div"),v=document.createElement("div"),w=document.createElement("button");r.classList.add("row","n-vdp-modal--each-vd");v.classList.add("row");l.classList.add("n-op__total-time");const y=createProcessDropdownList1(window.CurrentOpdts,n.PartNo),i=`sp${n.PartNo}`;return v.appendChild(y),$(y).multiselect({enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:300,buttonWidth:"200px",onChange:t=>{const r=_videoOpdts1.find(n=>n.OpSerial===t[0].value.toString());r?(MsgInform("Alert",`This process was selected for video number: ${r.PartNo}`,"error",!0,!0),r.OpSerial?console.log(r.OpSerial):(document.getElementById(i).innerHTML="Select process!",document.getElementById(i).style.cssText="color: red !important")):(n.OpSerial=t[0].value.toString(),n.DisplayName=t[0].text,document.getElementById(i).innerHTML=t[0].text,document.getElementById(i).style.cssText=t[0].value.toString()==="0"?"color: red !important":"color: #000 !important",console.log(t[0].value))},templates:{button:`<span id=${i} class="multiselect dropdown-toggle n-vdp__drp-text" data-toggle="dropdown">Select process!</span>`}}),r.appendChild(a),r.appendChild(v),w.classList.add("glyphicon","glyphicon-plus-sign","n-op__btn--add-process"),t.classList.add("n-op-vdp__video"),f.classList.add("col-md-9"),u.classList.add("col-md-3"),s.classList.add("row"),c.classList.add("row"),e.classList.add("row"),e.innerHTML="Total time: ",l.innerHTML=new Date(n.TotalTime*1e3).toISOString().substr(11,8),e.appendChild(l),o.classList.add("n-vdp__btn-close-part-video"),c.innerHTML=`${n.StartTime} - ${n.EndTime}`,h.innerHTML=`${n.PartNo}`,h.classList.add("n-op__part-no"),s.appendChild(h),o.addEventListener("click",()=>{ConfirmYesNo("Confirmation","Are you sure to remove this video?",()=>{r.remove();const i=document.getElementsByClassName("vdp-modal--each-vd");i&&i.length===0&&(_partVideo1=0);const t=_videoOpdts1.map(n=>n.PartNo).indexOf(n.PartNo);t>-1&&(_videoOpdts1.splice(t,1),_splitVideo1.splice(t,1));const u=document.getElementById(`divPart${n.PartNo}`);u&&u.remove();const f=document.getElementById(`imgPart${n.PartNo}`);f&&f.remove()},()=>{})}),_currentVideoSrc1&&t.setAttribute("src",_currentVideoSrc1),t.setAttribute("controls","controls"),t.currentTime=convertToSecond1(n.StartTime),t.ontimeupdate=()=>{t.currentTime>=convertToSecond1(n.EndTime)&&t.pause()},f.appendChild(t),u.appendChild(s),u.appendChild(c),u.appendChild(e),o.appendChild(p),f.appendChild(o),a.appendChild(f),a.appendChild(u),r}function moveSlidersToNewRangeTime1(n){console.log("Moving start/end sliders to new positions by default second.");const t=_sliderRight1.style.left,e=parseFloat(t.replace(/%/gi,"")),i=_sliderLeft1.style.left,o=_txtCropSec1.value,u=_vidTag1.duration/100*e;let r=parseInt(o)+u,f=r/_vidTag1.duration*100;if(e<100)if(parseInt(o)<1)MsgInform("Error","Invalid splitting second!","error",!1,!0);else{console.log(_spSplitBar1.style.width);_sliderLeft1.style.left=t;r>_vidTag1.duration&&(r=_vidTag1.duration);_vidTag1.currentTime=u;f>100&&(f=100);_sliderRight1.style.left=`${f}%`;spSplitBar1.style.left=t;_circleSlider1.style.left=t;const o=new Date(u*1e3).toISOString(),s=new Date(r*1e3).toISOString();_startH1.value=o.substr(11,2);_startM1.value=o.substr(14,2);_startS1.value=o.substr(17,2);_endH1.value=s.substr(11,2);_endM1.value=s.substr(14,2);_endS1.value=s.substr(17,2);const h=_vidTag1.duration/100*parseFloat(i.replace(/%/gi,""));let e=new SplitControl(n.Edition,n.StyleCode,n.StyleColorSerial,n.StyleSize,n.RevNo,n.OpRevNo,n.OpSerial,n.StartTime,n.EndTime,n.PartNo,n.DisplayName,n.TotalTime,n.TotalTimeStr,n.BarBgColor,i,t,spSplitBar1.style.width,h);console.log(e);_splitVideo1.push(e);document.getElementById(DivBarPart1).appendChild(addPartBar1(e));console.log("Adding video thumbnail image to div");_divVideoThumbnail.appendChild(takeVideoThumbnail(e));const c=_sliderLeft1.getBoundingClientRect(),l=_sliderRight1.getBoundingClientRect(),a=_sliderWrap1.clientWidth,v=(l.x-c.x)/a*100;spSplitBar1.style.width=`${v}%`;console.log("Create object then add to right div.");console.log(n)}else{_limitedCropping1=!0;const u=_vidTag1.duration/100*parseFloat(i.replace(/%/gi,""));let r=new SplitControl(n.Edition,n.StyleCode,n.StyleColorSerial,n.StyleSize,n.RevNo,n.OpRevNo,n.OpSerial,n.StartTime,n.EndTime,n.PartNo,n.DisplayName,n.TotalTime,n.TotalTimeStr,n.BarBgColor,i,t,spSplitBar1.style.width,u);_splitVideo1.push(r);document.getElementById(DivBarPart1).appendChild(addPartBar1(r));console.log("Adding video thumbnail image to div");_divVideoThumbnail.appendChild(takeVideoThumbnail(r))}}function moveSplittingControls1(n,t,i,r,u,f){console.log(n);_sliderLeft1.style.left=n;_vidTag1.currentTime=r;_sliderRight1.style.left=t;spSplitBar1.style.left=n;spSplitBar1.style.width=i;_startH1.value=u.substr(0,2);_startM1.value=u.substr(3,2);_startS1.value=u.substr(6,2);_endH1.value=f.substr(0,2);_endM1.value=f.substr(3,2);_endS1.value=f.substr(6,2)}function addPartBar1(n){const t=document.createElement("div");return t.id=`divPart${n.PartNo}`,t.addEventListener("click",()=>{moveSplittingControls1(n.StartedSplittingLeft,n.EndedSplittingLeft,n.SplittingBarWidth,n.StartedDuration,n.StartTime,n.EndTime)}),t.style.backgroundColor=n.BarBgColor,t.style.left=n.StartedSplittingLeft,t.style.width=n.SplittingBarWidth,t.style.cursor="pointer",t.innerHTML=n.PartNo,t}function cropVideo1(){if(validateStartEndTime1(!0)){console.log("Crop video...");_partVideo1++;const t=parseInt(_endH1.value)*3600+parseInt(_endM1.value)*60+parseInt(_endS1.value)-(parseInt(_startH1.value)*3600+parseInt(_startM1.value)*60+parseInt(_startS1.value)),n=GetSelectedOneRowData(gridOpsTableId);console.log(t);_txtCropSec1.value=t;colorIndex1===BarColour1.length&&(colorIndex1=0);const r=BarColour1[colorIndex1];colorIndex1++;let i=new VideoOpdt(n.Edition,n.StyleCode,n.StyleColorSerial,n.StyleSize,n.RevNo,n.OpRevNo,null,`${_startH1.value}:${_startM1.value}:${_startS1.value}`,`${_endH1.value}:${_endM1.value}:${_endS1.value}`,_partVideo1,null,t,new Date(t*1e3).toISOString().substr(11,8),r);_videoOpdts1.push(i);moveSlidersToNewRangeTime1(i);document.getElementById(DivProcessVideo1).style.cssText="display:flex !important"}}function CreateProgressBar(){const t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div");return t.id=DivProgressBarWrapper,n.id=DivProgressBar,t.classList.add("op__progress-bar-wrapper"),i.classList.add("op__progress"),n.classList.add("progress-bar"),n.style.width="50%",n.style.height="20px",i.appendChild(n),t.appendChild(i),t}function PreviewVideo(n,t){console.log("Preview video.");console.log(t);const i=document.getElementById(VdPreviewMax);i.src=n;i.currentTime=convertToSecond1(t.StartTime);i.ontimeupdate=()=>{i.currentTime>=convertToSecond1(t.EndTime)&&i.pause()};document.getElementById(DivPartNoMax).innerHTML=t.PartNo;document.getElementById(DivRangTimeMax).innerHTML=`${t.StartTime} : ${t.EndTime}`;document.getElementById(SpTotalTimeMax).innerHTML=t.TotalTimeStr}function takeVideoThumbnail(n){const t=document.createElement("canvas"),r=1,i=document.createElement("img"),u=60;i.id=`imgPart${n.PartNo}`;i.style.border=`3px solid ${n.BarBgColor}`;i.style.left=n.StartedSplittingLeft;const f=_vidTag1.videoWidth*u/_vidTag1.videoHeight;return t.width=f*r,t.height=u*r,t.getContext("2d").drawImage(_vidTag1,0,0,t.width,t.height),i.src=t.toDataURL(),n.ThumbnailImage=t.toDataURL(),i.addEventListener("click",()=>{console.log("Click thumbnail video."),_divVideoRightList1.style.display="block",_appElement&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().SplitVideoUrl=_vidTag1.src,angular.element(_appElement).scope().selectedVideo=n}),PreviewVideo(_vidTag1.src,n)}),i}function dragStartVideo1(n){_isDraggingVideo=!0;console.log(n.currentTarget.alt);event.dataTransfer.setData("VideoNo",n.currentTarget.alt)}function allowDropCanvas(n){n.preventDefault()}function dropCanvas(n){if(n.preventDefault(),_isDraggingVideo)if(window.CurrentOpmt){const t=n.dataTransfer.getData("VideoNo"),i=_videoOpdts1.find(n=>n.PartNo.toString()===t);console.log(`videoNo: ${t}`);console.log("dragVideo");console.log(i);console.log(n.currentTarget);console.log(window.CurrentOpmt);AsyncGetMaxOpSerial(n=>{if(n&&n.trim()!==""){console.log(`OpSerial: ${n}`);const t=window.CurrentOpmt.Edition.substring(0,1),i=new Opdt(t,window.CurrentOpmt.Edition,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,n,"Opname",null,null,null,null,angular.element(_appElement).scope().layoutPage.pageNo,0,0,"#FFFFFFFF"),r=[new Opnt(t,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,n,1,3600)],u=new AjaxConfig(InsertProcessUrl,!0,JSON.stringify({opDetail:i,lstOpMachine:[],lstOpTool:[],lstOpnt:r}));AjaxPostCommon(u,t=>{if(console.log(t),t==="success"){const t=new LayoutProcess(n.toString(),`[] Opname`,0,0,"",0,"Opname","Opname","Opname","Opname","Opname","Opname","",[],[],0,0,"","",null,null,null,"#A9A9A9",angular.element(_appElement).scope().pLayoutModifier.pWidth,angular.element(_appElement).scope().pLayoutModifier.pHeight,angular.element(_appElement).scope().opsFont.fontSize,[],!0,window.LayoutPage,window.CanDelete,!0,0,0,null,"",["settings.svg"],window.ProcessIconPath,"settings.svg");toolkit.addNode(t);ShowMessageOk("001",SmsFunction.Add,MessageType.Success,MessageContext.Add,ObjMessageType.Info)}else ShowMessageOk("001",SmsFunction.Add,MessageType.Error,MessageContext.Error,ObjMessageType.Error,t)})}else console.log("Could not get max of OpSerial")})}else console.log("No current opmt.");else console.log("The video was dropped to a process.")}function allowDropVideo1(n){n.preventDefault()}function dropVideo1(n){n.preventDefault();const t=n.dataTransfer.getData("VideoNo"),r=_videoOpdts1.find(n=>n.PartNo.toString()===t),i=n.currentTarget.id.substr(4),u=_videoOpdts1.find(n=>n.OpSerial===i),f=document.getElementById(`pOpName${i}`);if(u)MsgInform("Alert",`This process was selected for video number: ${u.PartNo}`,"error",!0,!0);else if(t){r.OpSerial=i;r.DisplayName=f.innerHTML;console.log(`Video number: ${t}`);console.log(`OpSerial: ${i}`);console.log($(`#selP${t}`));$(`#selP${t}`).multiselect("deselectAll",!1);$(`#selP${t}`).multiselect("select",[i.toString()]);$(`#selP${t}`).multiselect("refresh");const u=document.getElementById("vdpAlerts"),n=createInformTag1(`&nbsp;Assigned video number '${t}' to process: ${f.innerHTML}`);u.appendChild(n);setTimeout(()=>{n.remove()},5e3);_isDraggingVideo=!1}else console.log("Wrong source element!")}function droppableProcessNodes1(){const n=toolkit.getNodes();for(var t of n){const n=$(`[data-jtk-node-id="${t.data.id}"]`);n[0]?($(n[0]).ondrop=n=>{n.preventDefault(),console.log("drop a video...")},$(n[0]).ondragover=n=>{n.stopPropagation(),n.preventDefault()}):console.log(n)}}function createInformTag1(n){const t=document.createElement("div"),i=document.createElement("button"),r=document.createElement("span"),u=document.createElement("span"),f=document.createElement("span");return t.classList.add("alert","alert-success","alert-dismissible","fadeIn"),t.width="100%",t.style.borderWidth=0,t.setAttribute("role","alert"),i.setAttribute("type","button"),i.setAttribute("data-dismiss","alert"),i.setAttribute("aria-label","Close"),i.classList.add("close"),i.style.top="-10px !important",r.setAttribute("aria-hidden","true"),r.innerHTML="&times;",i.appendChild(r),t.appendChild(i),u.classList.add("glyphicon","glyphicon-ok"),t.appendChild(u),f.innerHTML=n,t.appendChild(f),t}function createAlertTag1(n){const t=document.createElement("div"),i=document.createElement("button"),r=document.createElement("span"),u=document.createElement("span"),f=document.createElement("strong"),s=document.createElement("br"),e=document.createElement("span"),h=document.createElement("br"),o=document.createElement("span");return t.classList.add("alert","alert-success","alert-dismissible","fadeIn"),t.width="100%",t.style.borderWidth=0,t.setAttribute("role","alert"),i.setAttribute("type","button"),i.setAttribute("data-dismiss","alert"),i.setAttribute("aria-label","Close"),i.classList.add("close"),i.style.top="-10px !important",r.setAttribute("aria-hidden","true"),r.innerHTML="&times;",i.appendChild(r),t.appendChild(i),u.classList.add("glyphicon","glyphicon-ok"),t.appendChild(u),f.innerHTML="&nbsp; Successfully!",t.appendChild(f),t.appendChild(s),e.innerHTML="Saved video for process",t.appendChild(e),t.appendChild(h),o.innerHTML=n,t.appendChild(o),t}function validateStartEndTime1(n){return startTimeToSecond1()>=endTimeToSecond1()?(n&&MsgInform("Error","Ending time must be greater than starting time.","error",!1,!0),!1):startTimeToSecond1()>=_vidTag1.duration?(n&&MsgInform("Error","Invalid starting time.","error",!1,!0),!1):endTimeToSecond1()>=_vidTag1.duration?(n&&MsgInform("Error","Invalid ending time.","error",!1,!0),!1):!0}function startTimeToSecond1(){return parseInt(_startH1.value)*3600+parseInt(_startM1.value)*60+parseInt(_startS1.value)}function endTimeToSecond1(){return parseInt(_endH1.value*3600)+parseInt(_endM1.value)*60+parseInt(_endS1.value)}function convertToSecond1(n){const t=n.substr(0,2),i=n.substr(3,2),r=n.substr(6,2);return parseInt(t)*3600+parseInt(i)*60+parseInt(r)}function changeTimeValue1(n){const t=parseInt(n.currentTarget.value);n.currentTarget.value=t?t<0?`0${t.toString().replace(/-/gi,"")}`:n.currentTarget.id===StartH||n.currentTarget.id===EndH?t<24?t.toString().length===1?`0${t}`:t:"23":t<60?t.toString().length===1?`0${t}`:t:"59":"00";(n.currentTarget.id===StartH||n.currentTarget.id===StartM||n.currentTarget.id===StartS)&&validateStartEndTime1(!1)&&(_isStartTimeChange1=!0,_vidTag1.currentTime=startTimeToSecond1());(n.currentTarget.id===EndH||n.currentTarget.id===EndM||n.currentTarget.id===EndS)&&validateStartEndTime1(!1)&&(_isEndTimeChange1=!0,_vidTag1.currentTime=endTimeToSecond1())}function mouseDownSliderLeft1(){console.log("Allow moving left slider");_isSlideLeft1=!0;_isSlide1=!0}function mouseDownSliderRight1(){console.log("Allow moving right slider");_isSlideRight1=!0;_isSlide1=!0}function oneSecondToPx1(n){const t=document.getElementById(VdProcess1).duration;return n/t}function getCurrentTime1(n){const t=_sliderWrap1.getBoundingClientRect(),i=n/t.width*100,r=document.getElementById(VdProcess1).duration;return i.toFixed(2)/100*r}function mouseMove1(n){const t=_sliderWrap1.getBoundingClientRect(),i=_circleSlider1.getBoundingClientRect();if(n.clientX>=t.left-i.width/2&&n.clientX<=t.width+t.left+i.width/2){const f=n.clientX-t.left,i=f/t.width*100,r=_sliderLeft1.getBoundingClientRect(),u=_sliderRight1.getBoundingClientRect();if(!_isSlide1||_isSlideLeft1||_isSlideRight1||(_circleSlider1.style.left=`${i}%`),_isSlideLeft1)if(u.x+u.width/2-n.clientX>oneSecondToPx1(t.width)){_isMsgBoxShow1=!1;_msgBox1.style.display="none";_sliderLeft1.style.left=`${i}%`;spSplitBar1.style.left=`${i}%`;const n=_sliderWrap1.clientWidth,t=(u.x-r.x)/n*100;spSplitBar1.style.width=`${t}%`;_circleSlider1.style.left=`${i}%`}else _isMsgBoxShow1=!0,_msgBox1.style.display="block";if(_isSlideRight1)if(n.clientX-(r.x+r.width/2)>oneSecondToPx1(t.width)){_isMsgBoxShow1=!0;_msgBox1.style.display="none";_sliderRight1.style.left=`${i}%`;const n=_sliderWrap1.clientWidth,t=(u.x-r.x)/n*100;spSplitBar1.style.width=`${t}%`;_circleSlider1.style.left=`${i}%`}else _msgBox1.style.display="block";if(_isSlide1){console.log("moving current slider");const n=_circleSlider1.style.left.replace(/%/gi,""),t=n/100*_vidTag1.duration;document.getElementById(VdProcess1).currentTime=t}}}function mouseUp1(){_isSlide1&&(_isSlide1=!1);_isSlideLeft1&&(_isSlideLeft1=!1);_isSlideRight1&&(_isSlideRight1=!1)}function mouseDownCurrentSlider1(){_isSlide1=!0}function ontimeUpdate1(n){const i=new Date(n.currentTarget.currentTime*1e3).toISOString(),t=n.currentTarget.currentTime/n.currentTarget.duration*100;if(document.getElementById(SpCurentTime1).innerHTML=i.substr(11,8),_circleSlider1.style.left=`${t}%`,console.log("timePercent"),console.log(t),_isSlideLeft1){_sliderLeft1.style.left=`${t}%`;spSplitBar1.style.left=`${t}%`;_startH1.value=i.substr(11,2);_startM1.value=i.substr(14,2);_startS1.value=i.substr(17,2);const n=_sliderLeft1.getBoundingClientRect(),r=_sliderRight1.getBoundingClientRect(),u=_sliderWrap1.clientWidth,f=(r.x-n.x)/u*100;spSplitBar1.style.width=`${f}%`}if(_isSlideRight1){_sliderRight1.style.left=`${t}%`;_endH1.value=i.substr(11,2);_endM1.value=i.substr(14,2);_endS1.value=i.substr(17,2);const n=_sliderLeft1.getBoundingClientRect(),r=_sliderRight1.getBoundingClientRect();spSplitBar1.style.width=`${r.x-n.x}px`;const u=_sliderWrap1.clientWidth,f=(r.x-n.x)/u*100;spSplitBar1.style.width=`${f}%`}if(_isStartTimeChange1){_isStartTimeChange1=!1;_sliderLeft1.style.left=`${t}%`;spSplitBar1.style.left=`${t}%`;const n=_sliderLeft1.getBoundingClientRect(),i=_sliderRight1.getBoundingClientRect(),r=_sliderWrap1.clientWidth,u=(i.x-n.x)/r*100;spSplitBar1.style.width=`${u}%`}if(_isEndTimeChange1){_isEndTimeChange1=!1;_sliderRight1.style.left=`${t}%`;const n=_sliderLeft1.getBoundingClientRect(),i=_sliderRight1.getBoundingClientRect(),r=_sliderWrap1.clientWidth,u=(i.x-n.x)/r*100;spSplitBar1.style.width=`${u}%`}}function playVideo1(n){n.currentTarget.classList.toggle("n-video-pause");const t=document.getElementById(VdProcess1);t.paused?t.play():t.pause()}function ClearAllVideoInfo1(){console.log("Clearing all video information.");_videoOpdts1=[];_splitVideo1=[];_partVideo1=0;colorIndex1=0;document.getElementById(VdProcess1).src="";document.getElementById(DivVideoTag1).style.cssText="display:none !important";document.getElementById(DivLoadVideo1).style.cssText="display:flex !important";document.getElementById(InputUploadVideo1).value="";_divVideoThumbnail.innerHTML="";document.getElementById(DivProcessVideo1).style.cssText="display:none !important";document.getElementById(DivBarPart1).innerHTML="";_divVideoRightList1.style.display="none";_appElement&&angular.element(_appElement).scope()&&angular.element(_appElement).scope().$$phase&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().SplitVideoUrl="",angular.element(_appElement).scope().selectedVideo={}});_txtCropSec1.value=60}function closeVdPreview1(){ConfirmYesNo("Confirmation","Are you sure to cancel this video?",()=>{ClearAllVideoInfo1()},()=>{})}function dragOverDivVideo1(n){n.target.style.backgroundColor="dodgerblue";n.target.style.borderColor="#fff";n.target.style.color="white";n.dataTransfer.setData("text/plain",n.target.id);console.log(n.currentTarget.files)}function dropDivVideo1(n){const t=n.dataTransfer.getData("text/plain");console.log(t);console.log(n.currentTarget.files)}function setDefaultSplitTime1(n){const t=new Date(n/100*_sliderLeft1.style.left.replace(/%/gi,"")*1e3).toISOString(),i=new Date(n/100*_sliderRight1.style.left.replace(/%/gi,"")*1e3).toISOString();_startH1.value=t.substr(11,2);_startM1.value=t.substr(14,2);_startS1.value=t.substr(17,2);_endH1.value=i.substr(11,2);_endM1.value=i.substr(14,2);_endS1.value=i.substr(17,2)}function posSplitControlsByDefaultSecond1(){const n=_txtCropSec1.value;if(parseInt(n)<1)MsgInform("Error","Invalid default second!","error",!1,!0);else{let t=n/_vidTag1.duration*100;console.log(t);t=t>100?100:t;console.log(t);_sliderLeft1.style.left="0%";spSplitBar1.style.left="0%";_circleSlider1.style.left="0%";_sliderRight1.style.left=`${t}%`;const u=_sliderLeft1.getBoundingClientRect(),f=_sliderRight1.getBoundingClientRect(),i=_sliderWrap1.clientWidth,r=(f.x-u.x)/i*100;spSplitBar1.style.width=`${r}%`;console.log(i);console.log(r)}}function onChangedInputVf1(n){console.log("Video file has been changed.");const i=document.getElementById(AVdPlay1);if(i.classList.remove("n-video-pause"),i.classList.add("n-video-preview"),console.log(n.currentTarget.files),n.currentTarget.files.length!==0){const r=URL.createObjectURL(n.currentTarget.files[0]),t=document.getElementById(VdProcess1);t.src=r;_currentVideoSrc1=URL.createObjectURL(n.currentTarget.files[0]);t.onloadeddata=()=>{if(console.log(t.duration),t.duration>86400)console.log("The video is too long.");else{const n=new Date(t.duration*1e3).toISOString().substr(11,8);document.getElementById(SpTotalTime1).innerHTML=n;console.log(n);posSplitControlsByDefaultSecond1();setDefaultSplitTime1(t.duration)}};console.log(n.currentTarget.files[0]);document.getElementById(DivVideoTag1).style.cssText="display:block !important";document.getElementById(DivLoadVideo1).style.cssText="display:none !important"}}const InputUploadVideo1="inputUploadVideo1",DivDropVideo1="divDropVideo1",LbUploadVideo1="lbUploadVideo1",VdProcess1="vdProcess1",JqVdProcess1="#vdProcess1",DivVideoTag1="divVideoTag1",DivLoadVideo1="divLoadVideo1",BtnCloseVdPreview1="btnCloseVdPreview1",AVdPlay1="aVdPlay1",SpTotalTime1="spTotalTime1",SpCurentTime1="spCurentTime1",DivCurrentSlider1="divCurrentSlider1",DivSliderWrap1="divSliderWrap1",SliderLeft1="sliderLeft1",SliderRight1="sliderRight1",SpSplitBar1="spSplitBar1",MsgBox1="msgBox1",BtnSplit1="btnSplit1",BtnUploadVideo1="btnUploadVideo1",BtnSaveVideo1="btnSaveVideo1",DivProcessVideo1="divProcessVideo1",DivVideoSide1="divVideoSide1",DivPartVideoSide1="divPartVideoSide1",DivBarPart1="divBarPart1",StartH1="startH1",StartM1="startM1",StartS1="startS1",EndH1="endH1",EndM1="endM1",EndS1="endS1",TxtCropSecond1="txtCropSecond1",SpMsgContent1="spMsgContent1",DivVideoRightList1="divVideoRightList1",DivGlobe1="divGlobe",BtnShowProcessVideoModal1="btnShowProcessVideoModal1",BtnCloseNvpModal="btnCloseNvpModal",DivRightVideoList1="divRightVideoList1",JsDivRightVideoList1="#divRightVideoList1",ModalFixedVp="modalFixedVp",JsModalFixedVp=$("#modalFixedVp"),JsModalFixedVp2=$("#modalFixedVp2"),BtnCloseRightVdList1="btnCloseRightVdList1",UrlUploadChunkVideos1="/OpLayout/UploadVideoChunkFile",UrlSplitOpdtVideos1="/OpLayout/SplitOpdtVideos",BarColour1=["#c5d6fc","#839dbe","#00384f","#34425a","#8e9dbe","#00384f"],DivVideoThumbnail="divVideoThumbnail",BtnMinimizeNvpModal="btnMinimizeNvpModal",VdPreviewMax="vdPreviewMax",DivPartNoMax="divPartNoMax",DivRangTimeMax="divRangTimeMax",SpTotalTimeMax="spTotalTimeMax",DivProgressBarWrapper="divProgressBarWrapper",DivProgressBar="divProgressBar",AjaxWaitMes1="<h3>Please wait...<\/h3>",InsertProcessUrl="/PlanManagement/AddNewProcess_New";var _modalFixedVp,_inputUploadVideo1,_isSlide1=!1,_isSlideLeft1=!1,_isSlideRight1=!1,_sliderWrap1,_sliderLeft1,_sliderRight1,_spSplitBar1,_txtCropSec1,_msgBox1,_isMsgBoxShow1=!1,_pxPerOneSecond1,_vidTag1,_circleSlider1,_startH1,_startM1,_startS1,_endH1,_endM1,_endS1,_btnSplit1,_isStartTimeChange1=!1,_isEndTimeChange1=!1,_currentVideoSrc1,_partVideo1=0,_videoOpdts1=[],_splitVideo1=[],colorIndex1=0,_limitedCropping1=!1,_divVideoRightList1,_divVideoThumbnail,_btnMinimizeNvpModal,_appElement,HideOpVideoModal1=!1,_isDraggingVideo=!1;(()=>{_sliderLeft1=document.getElementById(SliderLeft1),_sliderRight1=document.getElementById(SliderRight1),_spSplitBar1=document.getElementById(SpSplitBar1),_msgBox1=document.getElementById(MsgBox1),_vidTag1=document.getElementById(VdProcess1),_circleSlider1=document.getElementById(DivCurrentSlider1),_startH1=document.getElementById(StartH1),_startM1=document.getElementById(StartM1),_startS1=document.getElementById(StartS1),_endH1=document.getElementById(EndH1),_endM1=document.getElementById(EndM1),_endS1=document.getElementById(EndS1),_btnSplit1=document.getElementById(BtnSplit1),_txtCropSec1=document.getElementById(TxtCropSecond1),_inputUploadVideo1=document.getElementById("inputUploadVideo1"),_modalFixedVp=document.getElementById(ModalFixedVp),_divVideoRightList1=document.getElementById(DivVideoRightList1),_divVideoThumbnail=document.getElementById(DivVideoThumbnail),_btnMinimizeNvpModal=document.getElementById(BtnMinimizeNvpModal),document.getElementById(BtnCloseVdPreview1).addEventListener("click",closeVdPreview1),document.getElementById(AVdPlay1).addEventListener("click",playVideo1),_appElement=document.querySelector("[ng-app=opsApp]"),document.getElementById(BtnCloseNvpModal).addEventListener("click",()=>{JsModalFixedVp.slideUp("slow"),_appElement&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().FixedModal.IsShow=!angular.element(_appElement).scope().FixedModal.IsShow})}),_inputUploadVideo1.addEventListener("change",onChangedInputVf1),_btnMinimizeNvpModal.addEventListener("click",()=>{JsModalFixedVp.slideUp("slow"),console.log("Displaying the modal."),setTimeout(()=>{$("#modalFixedVp2").slideDown("slow")},500),angular.element(_appElement).scope().$apply(()=>{console.log("Current list of split-videos."),console.log(_splitVideo1),angular.element(_appElement).scope().OpVideo1=_splitVideo1})}),_startH1.addEventListener("change",changeTimeValue1),_startM1.addEventListener("change",changeTimeValue1),_startS1.addEventListener("change",changeTimeValue1),_endH1.addEventListener("change",changeTimeValue1),_endM1.addEventListener("change",changeTimeValue1),_endS1.addEventListener("change",changeTimeValue1),_btnSplit1.addEventListener("click",cropVideo1),_circleSlider1.addEventListener("mousedown",mouseDownCurrentSlider1),_sliderLeft1.addEventListener("mousedown",mouseDownSliderLeft1),_sliderRight1.addEventListener("mousedown",mouseDownSliderRight1),window.addEventListener("mousemove",mouseMove1),window.addEventListener("mouseup",mouseUp1),document.getElementById(VdProcess1).ontimeupdate=n=>{ontimeUpdate1(n)},_sliderWrap1=document.getElementById(DivSliderWrap1),document.getElementById(BtnUploadVideo1).addEventListener("click",()=>{SaveProcessVideo1()}),document.body.appendChild(CreateProgressBar())})();class OpMaster extends StyleMaster{constructor(n,t,i,r,u){super(n,t,i,r);this.OpRevNo=u}}class VideoOpdt extends OpMaster{constructor(n,t,i,r,u,f,e,o,s,h,c,l,a,v){super(t,i,r,u,f);this.Edition=n;this.OpSerial=e;this.StartTime=o;this.EndTime=s;this.PartNo=h;this.DisplayName=c;this.TotalTime=l;this.TotalTimeStr=a;this.BarBgColor=v}}class SplitControl extends VideoOpdt{constructor(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){super(n,t,i,r,u,f,e,o,s,h,c,l,a,v);this.StartedSplittingLeft=y;this.EndedSplittingLeft=p;this.SplittingBarWidth=w;this.StartedDuration=b;this.ThumbnailImage=k}}