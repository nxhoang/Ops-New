const InputUploadVideo1="inputUploadVideo1",DivDropVideo1="divDropVideo1",LbUploadVideo1="lbUploadVideo1",VdProcess1="vdProcess1",JqVdProcess1="#vdProcess1",DivVideoTag1="divVideoTag1",DivLoadVideo1="divLoadVideo1",BtnCloseVdPreview1="btnCloseVdPreview1",AVdPlay1="aVdPlay1",SpTotalTime1="spTotalTime1",SpCurentTime1="spCurentTime1",DivCurrentSlider1="divCurrentSlider1",DivSliderWrap1="divSliderWrap1",SliderLeft1="sliderLeft1",SliderRight1="sliderRight1",SpSplitBar1="spSplitBar1",MsgBox1="msgBox1",BtnSplit1="btnSplit1",BtnUploadVideo1="btnUploadVideo1",BtnSaveVideo1="btnSaveVideo1",DivProcessVideo1="divProcessVideo1",DivVideoSide1="divVideoSide1",DivPartVideoSide1="divPartVideoSide1",DivBarPart1="divBarPart1",StartH1="startH1",StartM1="startM1",StartS1="startS1",EndH1="endH1",EndM1="endM1",EndS1="endS1",TxtCropSecond1="txtCropSecond1",SpMsgContent1="spMsgContent1",DivVideoRightList1="divVideoRightList1",DivGlobe1="divGlobe",BtnShowProcessVideoModal1="btnShowProcessVideoModal1",BtnCloseNvpModal="btnCloseNvpModal",DivRightVideoList1="divRightVideoList1",JsDivRightVideoList1="#divRightVideoList1",ModalFixedVp="modalFixedVp",JsModalFixedVp=$("#modalFixedVp"),JsModalFixedVp2=$("#modalFixedVp2"),BtnCloseRightVdList1="btnCloseRightVdList1",UrlUploadChunkVideos1="/OpLayout/UploadVideoChunkFile",UrlSplitOpdtVideos1="/OpLayout/SplitOpdtVideos",BarColour1=["#c5d6fc","#839dbe","#00384f","#34425a","#8e9dbe","#00384f"],DivVideoThumbnail="divVideoThumbnail",BtnMinimizeNvpModal="btnMinimizeNvpModal",VdPreviewMax="vdPreviewMax",DivPartNoMax="divPartNoMax",DivRangeTimeMax="divRangeTimeMax",SpTotalTimeMax="spTotalTimeMax",DivProgressBarWrapper="divProgressBarWrapper",DivProgressBar="divProgressBar",AjaxWaitMes1="<h3>Please wait...</h3>",InsertProcessUrl="/PlanManagement/AddNewProcess_New",CkAllVideo="ckAllVideo",defaultOpnm=new Opnm(3600,"Opname","Opname","Opname","Opname","Opname","Opname");var _modalFixedVp,_inputUploadVideo1,_sliderWrap1,_sliderLeft1,_sliderRight1,_spSplitBar1,_txtCropSec1,_msgBox1,_pxPerOneSecond1,_vidTag1,_circleSlider1,_startH1,_startM1,_startS1,_endH1,_endM1,_endS1,_btnSplit1,_currentVideoSrc1,_divVideoRightList1,_divVideoThumbnail,_btnMinimizeNvpModal,_appElement,_isSlide1=!1,_isSlideLeft1=!1,_isSlideRight1=!1,_isMsgBoxShow1=!1,_isStartTimeChange1=!1,_isEndTimeChange1=!1,_partVideo1=0,_videoOpdts1=[],_splitVideo1=[],colorIndex1=0,_limitedCropping1=!1,HideOpVideoModal1=!1,_isDraggingVideo=!1;function SaveProcessVideo1(){const e=_videoOpdts1.filter(e=>e.OpSerial&&"0"!==e.OpSerial);console.log(e),e&&e.length>0?UploadMainVideoToServer1():MsgInform("Information","There are not any processes that are assigned to videos.","error",!1,!0)}function SplitVideoOp1(e,t){const n=_videoOpdts1.filter(e=>e.OpSerial&&"0"!==e.OpSerial),o=new AjaxConfig(UrlSplitOpdtVideos1,!0,JSON.stringify({opdtVideos:n,inputFilePath:e,connectionId:t}));return AjaxPostCommon(o,e=>{if(console.log(e),!1===e.IsSuccess)MsgInform("Error","An error occured, please try again or contact admin.","error",!1,!0);else{for(var t of e){const e=toolkit.getNode(t.Result.OpSerial);e.data.ShowButtonPlayVideo=!0,toolkit.updateNode(e)}document.getElementById(DivGlobe1).style.display="none"}})}function SendCroppedOpdtVideoInfo1(e,t){const n=_videoOpdts1.filter(e=>e.OpSerial&&"0"!==e.OpSerial);return $.post(UrlSplitOpdtVideos1,{opdtVideos:n,inputFilePath:e,connectionId:t}).done(e=>{if(console.log(e),!1===e.IsSuccess)MsgInform("Error","An error occured, please try again or contact admin.","error",!1,!0);else{for(var t of e){const e=toolkit.getNode(t.Result.OpSerial);e.data.ShowButtonPlayVideo=!0,toolkit.updateNode(e)}document.getElementById(DivGlobe1).style.display="none"}}).fail((e,t,n)=>{HandleException(e,t,n)})}function UploadMainVideoToServer1(){const e=uuidv4(),t=$("#inputUploadVideo1")[0].files;if(0===t.length)console.log("No file to upload");else{const n=t[0],o=[],i=3145728,l=GetSelectedOneRowData(gridOpsTableId);let d=0,r=i;const a=n.size;for(;d<a;)o.push(n.slice(d,r)),r=(d=r)+i;const s=o.length,p=[];let c,u=0,m=[];$.blockUI({fadeIn:1e3,message:"<h3>Uploading video to the server...</h3>",onBlock:()=>{for(;o.length>0;){u++;const t=o.shift(),i=n.name+".part_"+u+"."+s,d=new FormData;d.append(n.name,t),d.append("FileName",n.name),d.append("FilePartName",i),d.append("guid",e),d.append("Edition",l.Edition2),d.append("StyleCode",l.StyleCode),d.append("StyleSize",l.StyleSize),d.append("StyleColorSerial",l.StyleColorSerial),d.append("RevNo",l.RevNo),d.append("OpRevNo",l.OpRevNo);const r=UploadChunkFile1(d,e=>{console.log(e),m.push(e),e&&e.IsSuccess&&e.Result&&(console.log("Done uploading video and file is merged."),console.log(e.Result),c=e.Result)});p.push(r)}$.when.apply($,p).done(()=>{if($.unblockUI(),console.log("All threads completed"),MsgInform("Information","Splitting video...\n We will notify once finish.","info",!1,!0),document.getElementById(DivGlobe1).style.display="block",c){const e=$.connection.opsVideoHub;console.log(e),e.client.sendMessage=((e,t)=>{console.log(e),console.log(`Number of video: ${t}`);const n=document.getElementById("vdpAlerts"),o=createAlertTag1(e);n.appendChild(o),setTimeout(()=>{o.remove()},5e3),document.getElementById(DivProgressBarWrapper).style.display="block";const i=t/_videoOpdts1.filter(e=>null!==e.OpSerial).length*100;document.getElementById(DivProgressBar).style.width=`${i.toFixed(2)}%`,document.getElementById(DivProgressBar).innerHTML=`${i.toFixed(2)}%`,100===i&&setTimeout(()=>{document.getElementById(DivProgressBarWrapper).style.display="none"},3e3)}),$.connection.hub.start().done(()=>{console.log("SignalR is started."),e.server.getConnectionId().done(e=>{SplitVideoOp1(c,e)})})}})}})}}function UploadChunkFile1(e,t){return $.ajax({url:UrlUploadChunkVideos1,async:!0,type:"POST",data:e,contentType:!1,processData:!1,success:e=>{t(e)},beforeSend:()=>{},complete:()=>{},error:e=>{console.log(e)}})}function createProcessDropdownList1(e,t){const n=document.createElement("select"),o=document.createElement("option");for(var i of(o.setAttribute("value",0),o.innerHTML="Select process!",n.appendChild(o),n.id=`selP${t}`,e)){const e=document.createElement("option"),t=i.OpNameLan?i.OpNameLan:i.OpName,o=i.OpNum?`[${i.OpNum}]`:"[]";e.setAttribute("value",i.OpSerial),e.innerHTML=`${o} ${t}`,n.appendChild(e)}return n}function createRightVideoList1(e){const t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),r=document.createElement("div"),a=document.createElement("span"),s=document.createElement("video"),p=document.createElement("button"),c=document.createElement("span"),u=document.createElement("div"),m=document.createElement("div"),g=document.createElement("button");t.classList.add("row","n-vdp-modal--each-vd"),m.classList.add("row"),a.classList.add("n-op__total-time");const S=createProcessDropdownList1(window.CurrentOpdts,e.PartNo),v=`sp${e.PartNo}`;return m.appendChild(S),$(S).multiselect({enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:300,buttonWidth:"200px",onChange:t=>{const n=_videoOpdts1.find(e=>e.OpSerial===t[0].value.toString());n?(MsgInform("Alert",`This process was selected for video number: ${n.PartNo}`,"error",!0,!0),n.OpSerial?console.log(n.OpSerial):(document.getElementById(v).innerHTML="Select process!",document.getElementById(v).style.cssText="color: red !important")):(e.OpSerial=t[0].value.toString(),e.DisplayName=t[0].text,document.getElementById(v).innerHTML=t[0].text,"0"===t[0].value.toString()?document.getElementById(v).style.cssText="color: red !important":document.getElementById(v).style.cssText="color: #000 !important",console.log(t[0].value))},templates:{button:`<span id=${v} class="multiselect dropdown-toggle n-vdp__drp-text" data-toggle="dropdown">Select process!</span>`}}),t.appendChild(u),t.appendChild(m),g.classList.add("glyphicon","glyphicon-plus-sign","n-op__btn--add-process"),s.classList.add("n-op-vdp__video"),n.classList.add("col-md-9"),o.classList.add("col-md-3"),i.classList.add("row"),d.classList.add("row"),r.classList.add("row"),r.innerHTML="Total time: ",a.innerHTML=new Date(1e3*e.TotalTime).toISOString().substr(11,8),r.appendChild(a),p.classList.add("n-vdp__btn-close-part-video"),d.innerHTML=`${e.StartTime} - ${e.EndTime}`,l.innerHTML=`${e.PartNo}`,l.classList.add("n-op__part-no"),i.appendChild(l),p.addEventListener("click",()=>{ConfirmYesNo("Confirmation","Are you sure to remove this video?",()=>{t.remove();const n=document.getElementsByClassName("vdp-modal--each-vd");n&&0===n.length&&(_partVideo1=0);const o=_videoOpdts1.map(e=>e.PartNo).indexOf(e.PartNo);o>-1&&(_videoOpdts1.splice(o,1),_splitVideo1.splice(o,1));const i=document.getElementById(`divPart${e.PartNo}`);i&&i.remove();const l=document.getElementById(`imgPart${e.PartNo}`);l&&l.remove()},()=>{})}),_currentVideoSrc1&&s.setAttribute("src",_currentVideoSrc1),s.setAttribute("controls","controls"),s.currentTime=convertToSecond1(e.StartTime),s.ontimeupdate=(()=>{s.currentTime>=convertToSecond1(e.EndTime)&&s.pause()}),n.appendChild(s),o.appendChild(i),o.appendChild(d),o.appendChild(r),p.appendChild(c),n.appendChild(p),u.appendChild(n),u.appendChild(o),t}function moveSlidersToNewRangeTime1(e){console.log("Moving start/end sliders to new positions by default second.");const t=_sliderRight1.style.left,n=parseFloat(t.replace(/%/gi,"")),o=_sliderLeft1.style.left,i=_txtCropSec1.value,l=_vidTag1.duration/100*n;let d=parseInt(i)+l,r=d/_vidTag1.duration*100;if(n<100)if(parseInt(i)<1)MsgInform("Error","Invalid splitting second!","error",!1,!0);else{console.log(_spSplitBar1.style.width),_sliderLeft1.style.left=t,d>_vidTag1.duration&&(d=_vidTag1.duration),_vidTag1.currentTime=l,r>100&&(r=100),_sliderRight1.style.left=`${r}%`,spSplitBar1.style.left=t,_circleSlider1.style.left=t;const n=new Date(1e3*l).toISOString(),i=new Date(1e3*d).toISOString();_startH1.value=n.substr(11,2),_startM1.value=n.substr(14,2),_startS1.value=n.substr(17,2),_endH1.value=i.substr(11,2),_endM1.value=i.substr(14,2),_endS1.value=i.substr(17,2);const a=_vidTag1.duration/100*parseFloat(o.replace(/%/gi,""));let s=new SplitControl(e.Edition,e.StyleCode,e.StyleColorSerial,e.StyleSize,e.RevNo,e.OpRevNo,e.OpSerial,e.StartTime,e.EndTime,e.PartNo,e.DisplayName,e.TotalTime,e.TotalTimeStr,e.BarBgColor,o,t,spSplitBar1.style.width,a);console.log(s),_splitVideo1.push(s),document.getElementById(DivBarPart1).appendChild(addPartBar1(s)),console.log("Adding video thumbnail image to div"),_divVideoThumbnail.appendChild(takeVideoThumbnail(s));const p=_sliderLeft1.getBoundingClientRect(),c=_sliderRight1.getBoundingClientRect(),u=_sliderWrap1.clientWidth,m=(c.x-p.x)/u*100;spSplitBar1.style.width=`${m}%`,console.log("Create object then add to right div."),console.log(e)}else{_limitedCropping1=!0;const n=_vidTag1.duration/100*parseFloat(o.replace(/%/gi,""));let i=new SplitControl(e.Edition,e.StyleCode,e.StyleColorSerial,e.StyleSize,e.RevNo,e.OpRevNo,e.OpSerial,e.StartTime,e.EndTime,e.PartNo,e.DisplayName,e.TotalTime,e.TotalTimeStr,e.BarBgColor,o,t,spSplitBar1.style.width,n);_splitVideo1.push(i),document.getElementById(DivBarPart1).appendChild(addPartBar1(i)),console.log("Adding video thumbnail image to div"),_divVideoThumbnail.appendChild(takeVideoThumbnail(i))}}function moveSplittingControls1(e,t,n,o,i,l){console.log(e),_sliderLeft1.style.left=e,_vidTag1.currentTime=o,_sliderRight1.style.left=t,spSplitBar1.style.left=e,spSplitBar1.style.width=n,_startH1.value=i.substr(0,2),_startM1.value=i.substr(3,2),_startS1.value=i.substr(6,2),_endH1.value=l.substr(0,2),_endM1.value=l.substr(3,2),_endS1.value=l.substr(6,2)}function addPartBar1(e){const t=document.createElement("div");return t.id=`divPart${e.PartNo}`,t.addEventListener("click",()=>{moveSplittingControls1(e.StartedSplittingLeft,e.EndedSplittingLeft,e.SplittingBarWidth,e.StartedDuration,e.StartTime,e.EndTime)}),t.style.backgroundColor=e.BarBgColor,t.style.left=e.StartedSplittingLeft,t.style.width=e.SplittingBarWidth,t.style.cursor="pointer",t.innerHTML=e.PartNo,t}function cropVideo1(){if(validateStartEndTime1(!0)){console.log("Crop video..."),_videoOpdts1&&0===_videoOpdts1.length&&(_partVideo1=0),_partVideo1++;const e=3600*parseInt(_endH1.value)+60*parseInt(_endM1.value)+parseInt(_endS1.value)-(3600*parseInt(_startH1.value)+60*parseInt(_startM1.value)+parseInt(_startS1.value)),t=GetSelectedOneRowData(gridOpsTableId);console.log(e),_txtCropSec1.value=e,colorIndex1===BarColour1.length&&(colorIndex1=0);const n=BarColour1[colorIndex1];colorIndex1++;let o=new VideoOpdt(t.Edition,t.StyleCode,t.StyleColorSerial,t.StyleSize,t.RevNo,t.OpRevNo,null,`${_startH1.value}:${_startM1.value}:${_startS1.value}`,`${_endH1.value}:${_endM1.value}:${_endS1.value}`,_partVideo1,null,e,new Date(1e3*e).toISOString().substr(11,8),n);_videoOpdts1.push(o),moveSlidersToNewRangeTime1(o),document.getElementById(DivProcessVideo1).style.cssText="display:flex !important"}}function CreateProgressBar(){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.id=DivProgressBarWrapper,n.id=DivProgressBar,e.classList.add("op__progress-bar-wrapper"),t.classList.add("op__progress"),n.classList.add("progress-bar"),n.style.width="50%",n.style.height="20px",t.appendChild(n),e.appendChild(t),e}function PreviewVideo(e,t){console.log("Preview video."),console.log(t);const n=document.getElementById(VdPreviewMax);n.src=e,n.currentTime=convertToSecond1(t.StartTime),n.ontimeupdate=(()=>{n.currentTime>=convertToSecond1(t.EndTime)&&n.pause()}),document.getElementById(DivPartNoMax).innerHTML=t.PartNo,document.getElementById(DivRangeTimeMax).innerHTML=`${t.StartTime} : ${t.EndTime}`,document.getElementById(SpTotalTimeMax).innerHTML=t.TotalTimeStr}function minModalThumbnailRemove(e){e.preventDefault(),console.log("What's happening 👹"),thumbnailContextmenu(e.currentTarget.alt)}_sliderLeft1=document.getElementById(SliderLeft1),_sliderRight1=document.getElementById(SliderRight1),_spSplitBar1=document.getElementById(SpSplitBar1),_msgBox1=document.getElementById(MsgBox1),_vidTag1=document.getElementById(VdProcess1),_circleSlider1=document.getElementById(DivCurrentSlider1),_startH1=document.getElementById(StartH1),_startM1=document.getElementById(StartM1),_startS1=document.getElementById(StartS1),_endH1=document.getElementById(EndH1),_endM1=document.getElementById(EndM1),_endS1=document.getElementById(EndS1),_btnSplit1=document.getElementById(BtnSplit1),_txtCropSec1=document.getElementById(TxtCropSecond1),_inputUploadVideo1=document.getElementById("inputUploadVideo1"),_modalFixedVp=document.getElementById(ModalFixedVp),_divVideoRightList1=document.getElementById(DivVideoRightList1),_divVideoThumbnail=document.getElementById(DivVideoThumbnail),_btnMinimizeNvpModal=document.getElementById(BtnMinimizeNvpModal),document.getElementById(BtnCloseVdPreview1).addEventListener("click",closeVdPreview1),document.getElementById(AVdPlay1).addEventListener("click",playVideo1),_appElement=document.querySelector("[ng-app=opsApp]"),document.getElementById(BtnCloseNvpModal).addEventListener("click",()=>{JsModalFixedVp.slideUp("slow"),_appElement&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().FixedModal.IsShow=!angular.element(_appElement).scope().FixedModal.IsShow})}),_inputUploadVideo1.addEventListener("change",onChangedInputVf1),_btnMinimizeNvpModal.addEventListener("click",()=>{JsModalFixedVp.slideUp("slow"),console.log("Displaying the modal."),setTimeout(()=>{$("#modalFixedVp2").slideDown("slow")},500),angular.element(_appElement).scope().$apply(()=>{console.log("Current list of split-videos."),console.log(_splitVideo1),angular.element(_appElement).scope().OpVideo1=_splitVideo1})}),_startH1.addEventListener("change",changeTimeValue1),_startM1.addEventListener("change",changeTimeValue1),_startS1.addEventListener("change",changeTimeValue1),_endH1.addEventListener("change",changeTimeValue1),_endM1.addEventListener("change",changeTimeValue1),_endS1.addEventListener("change",changeTimeValue1),_btnSplit1.addEventListener("click",cropVideo1),_circleSlider1.addEventListener("mousedown",mouseDownCurrentSlider1),_sliderLeft1.addEventListener("mousedown",mouseDownSliderLeft1),_sliderRight1.addEventListener("mousedown",mouseDownSliderRight1),window.addEventListener("mousemove",mouseMove1),window.addEventListener("mouseup",mouseUp1),document.getElementById(VdProcess1).ontimeupdate=(e=>{ontimeUpdate1(e)}),_sliderWrap1=document.getElementById(DivSliderWrap1),document.getElementById(BtnUploadVideo1).addEventListener("click",()=>{SaveProcessVideo1()}),document.body.appendChild(CreateProgressBar());const minMdRemoveThumbnail=e=>{document.getElementById(`liThumbnail${e}`)&&document.getElementById(`liThumbnail${e}`).remove(),document.getElementById(`liBar${e}`)&&document.getElementById(`liBar${e}`).remove()};function thumbnailContextmenu(e){ConfirmYesNo("Confirmation","Are you sure to remove this video?",()=>{const t=_videoOpdts1.map(e=>e.PartNo.toString()).indexOf(e.toString());console.log("Coming here 👹"),console.log(t),t>-1&&(_videoOpdts1.splice(t,1),_splitVideo1.splice(t,1),console.log("After removing 👹"),console.log(_videoOpdts1),console.log(_splitVideo1));const n=document.getElementById(`divPart${e}`);n&&n.remove();const o=document.getElementById(`imgPart${e}`);o&&o.remove(),minMdRemoveThumbnail(e)},()=>{})}function takeVideoThumbnail(e){const t=document.createElement("canvas"),n=document.createElement("img");n.id=`imgPart${e.PartNo}`,n.style.border=`3px solid ${e.BarBgColor}`,n.style.left=e.StartedSplittingLeft;const o=60*_vidTag1.videoWidth/_vidTag1.videoHeight;return t.width=1*o,t.height=60,t.getContext("2d").drawImage(_vidTag1,0,0,t.width,t.height),n.src=t.toDataURL(),e.ThumbnailImage=t.toDataURL(),n.addEventListener("click",()=>{console.log("Click thumbnail video."),_divVideoRightList1.style.display="block",_appElement&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().SplitVideoUrl=_vidTag1.src,angular.element(_appElement).scope().selectedVideo=e}),moveSplittingControls1(e.StartedSplittingLeft,e.EndedSplittingLeft,e.SplittingBarWidth,e.StartedDuration,e.StartTime,e.EndTime),PreviewVideo(_vidTag1.src,e)}),n.addEventListener("contextmenu",t=>{t.preventDefault(),console.log(e.PartNo),thumbnailContextmenu(e.PartNo)}),n}function dragStartVideo1(e){_isDraggingVideo=!0,console.log(e.currentTarget.alt),event.dataTransfer.setData("VideoNo",e.currentTarget.alt)}function allowDropCanvas(e){e.preventDefault()}async function generateSimpleProcessAsync(e,t,n,o){const i=await GetMaxOpSerialAsync();if(i&&""!==i.trim()){console.log(`OpSerial: ${i}`);const l=GetOpnmByLang(defaultOpnm,angular.element(_appElement).scope().selectedLang),d=window.CurrentOpmt.Edition.substring(0,1),r=new Opdt(d,window.CurrentOpmt.Edition,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,i,l,null,null,null,null,angular.element(_appElement).scope().layoutPage.pageNo,t,0,DefaultColor,parseInt(i).toString()),a=[new Opnt(d,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,i,o,defaultOpnm.OpNameId)],s=new AjaxConfig(InsertProcessUrl,!0,JSON.stringify({opDetail:r,lstOpMachine:[],lstOpTool:[],lstOpnt:a})),p=_videoOpdts1.find(e=>e.OpSerial===i.trim()),c=await PostAjaxAsync(s);if(console.log(c),"success"===c){console.log("💋"),console.log(t);const o=new LayoutProcess(i.toString(),`[${parseInt(i).toString()}] ${l}`,0,0,"",0,l,defaultOpnm.Vietnam,defaultOpnm.English,defaultOpnm.Myanmar,defaultOpnm.Indonesia,defaultOpnm.Ethiopia,"",[],[],t,n,i,"",null,null,null,DefaultDisplayColor,angular.element(_appElement).scope().pLayoutModifier.pWidth,angular.element(_appElement).scope().pLayoutModifier.pHeight,angular.element(_appElement).scope().opsFont.fontSize,[],!0,window.LayoutPage,window.CanDelete,!0,t,0,null,"",[DefaultIcon],window.ProcessIconPath,DefaultIcon);toolkit.addNode(o),p&&(p.OpSerial=null),e.OpSerial=i.trim()}else ShowMessageOk("001",SmsFunction.Add,MessageType.Error,MessageContext.Error,ObjMessageType.Error,c)}else console.log("Could not get max of OpSerial")}function generateSimpleProcess(e,t,n,o){AsyncGetMaxOpSerial(i=>{if(i&&""!==i.trim()){console.log(`OpSerial: ${i}`);const l=GetOpnmByLang(defaultOpnm,angular.element(_appElement).scope().selectedLang),d=window.CurrentOpmt.Edition.substring(0,1),r=new Opdt(d,window.CurrentOpmt.Edition,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,i,l,null,null,null,null,angular.element(_appElement).scope().layoutPage.pageNo,0,0,DefaultColor,parseInt(i).toString()),a=[new Opnt(d,window.CurrentOpmt.StyleCode,window.CurrentOpmt.StyleColorSerial,window.CurrentOpmt.StyleSize,window.CurrentOpmt.RevNo,window.CurrentOpmt.OpRevNo,i,o,defaultOpnm.OpNameId)],s=new AjaxConfig(InsertProcessUrl,!0,JSON.stringify({opDetail:r,lstOpMachine:[],lstOpTool:[],lstOpnt:a})),p=_videoOpdts1.find(e=>e.OpSerial===i.trim());AjaxPostCommon(s,o=>{if(console.log(o),"success"===o){const o=new LayoutProcess(i.toString(),`[${parseInt(i).toString()}] ${l}`,0,0,"",0,l,defaultOpnm.Vietnam,defaultOpnm.English,defaultOpnm.Myanmar,defaultOpnm.Indonesia,defaultOpnm.Ethiopia,"",[],[],t,n,i,"",null,null,null,DefaultDisplayColor,angular.element(_appElement).scope().pLayoutModifier.pWidth,angular.element(_appElement).scope().pLayoutModifier.pHeight,angular.element(_appElement).scope().opsFont.fontSize,[],!0,window.LayoutPage,window.CanDelete,!0,0,0,null,"",[DefaultIcon],window.ProcessIconPath,DefaultIcon);toolkit.addNode(o),p&&(p.OpSerial=null),e.OpSerial=i.trim(),ShowMessageOk("001",SmsFunction.Add,MessageType.Success,MessageContext.Add,ObjMessageType.Info)}else ShowMessageOk("001",SmsFunction.Add,MessageType.Error,MessageContext.Error,ObjMessageType.Error,o)})}else console.log("Could not get max of OpSerial")})}async function dropCanvas(e){if(e.preventDefault(),_isDraggingVideo)if(window.CurrentOpmt){const n=e.dataTransfer.getData("VideoNo"),o=_videoOpdts1.find(e=>e.PartNo.toString()===n),i=document.getElementById(CkAllVideo);if(console.log(n),console.log(o),i.checked){console.log("generate processes based on all videos.");let e=0,n=0;for(var t of _videoOpdts1)await generateSimpleProcessAsync(t,e,n,1),e+=150;ShowMessageOk("001",SmsFunction.Add,MessageType.Success,MessageContext.Add,ObjMessageType.Info)}else generateSimpleProcess(o,0,0,1)}else console.log("No current opmt.");else console.log("The video was dropped to a process.")}function allowDropVideo1(e){e.preventDefault()}function dropVideo1(e){e.preventDefault();const t=e.dataTransfer.getData("VideoNo"),n=_videoOpdts1.find(e=>e.PartNo.toString()===t),o=e.currentTarget.id.substr(4),i=_videoOpdts1.find(e=>e.OpSerial===o),l=document.getElementById(`pOpName${o}`);if(_isDraggingVideo=!1,t){i&&(i.OpSerial=null),n.OpSerial=o,n.DisplayName=l.innerHTML,console.log(`Video number: ${t}`),console.log(`OpSerial: ${o}`),console.log($(`#selP${t}`)),$(`#selP${t}`).multiselect("deselectAll",!1),$(`#selP${t}`).multiselect("select",[o.toString()]),$(`#selP${t}`).multiselect("refresh");const e=document.getElementById("vdpAlerts"),d=createInformTag1(`&nbsp;Assigned video number '${t}' to process: ${l.innerHTML}`);e.appendChild(d),setTimeout(()=>{d.remove()},5e3)}else console.log("Wrong source element!")}function droppableProcessNodes1(){const e=toolkit.getNodes();for(var t of e){const e=$(`[data-jtk-node-id="${t.data.id}"]`);e[0]?($(e[0]).ondrop=(e=>{e.preventDefault(),console.log("drop a video...")}),$(e[0]).ondragover=(e=>{e.stopPropagation(),e.preventDefault()})):console.log(e)}}function createInformTag1(e){const t=document.createElement("div"),n=document.createElement("button"),o=document.createElement("span"),i=document.createElement("span"),l=document.createElement("span");return t.classList.add("alert","alert-success","alert-dismissible","fadeIn"),t.width="100%",t.style.borderWidth=0,t.setAttribute("role","alert"),n.setAttribute("type","button"),n.setAttribute("data-dismiss","alert"),n.setAttribute("aria-label","Close"),n.classList.add("close"),n.style.top="-10px !important",o.setAttribute("aria-hidden","true"),o.innerHTML="&times;",n.appendChild(o),t.appendChild(n),i.classList.add("glyphicon","glyphicon-ok"),t.appendChild(i),l.innerHTML=e,t.appendChild(l),t}function createAlertTag1(e){const t=document.createElement("div"),n=document.createElement("button"),o=document.createElement("span"),i=document.createElement("span"),l=document.createElement("strong"),d=document.createElement("br"),r=document.createElement("span"),a=document.createElement("br"),s=document.createElement("span");return t.classList.add("alert","alert-success","alert-dismissible","fadeIn"),t.width="100%",t.style.borderWidth=0,t.setAttribute("role","alert"),n.setAttribute("type","button"),n.setAttribute("data-dismiss","alert"),n.setAttribute("aria-label","Close"),n.classList.add("close"),n.style.top="-10px !important",o.setAttribute("aria-hidden","true"),o.innerHTML="&times;",n.appendChild(o),t.appendChild(n),i.classList.add("glyphicon","glyphicon-ok"),t.appendChild(i),l.innerHTML="&nbsp; Successfully!",t.appendChild(l),t.appendChild(d),r.innerHTML="Saved video for process",t.appendChild(r),t.appendChild(a),s.innerHTML=e,t.appendChild(s),t}function validateStartEndTime1(e){return startTimeToSecond1()>=endTimeToSecond1()?(e&&MsgInform("Error","Ending time must be greater than starting time.","error",!1,!0),!1):startTimeToSecond1()>=_vidTag1.duration?(e&&MsgInform("Error","Invalid starting time.","error",!1,!0),!1):!(endTimeToSecond1()>=_vidTag1.duration)||(e&&MsgInform("Error","Invalid ending time.","error",!1,!0),!1)}function startTimeToSecond1(){return 3600*parseInt(_startH1.value)+60*parseInt(_startM1.value)+parseInt(_startS1.value)}function endTimeToSecond1(){return parseInt(3600*_endH1.value)+60*parseInt(_endM1.value)+parseInt(_endS1.value)}function convertToSecond1(e){const t=e.substr(0,2),n=e.substr(3,2),o=e.substr(6,2);return 3600*parseInt(t)+60*parseInt(n)+parseInt(o)}function changeTimeValue1(e){const t=parseInt(e.currentTarget.value);t?t<0?e.currentTarget.value=`0${t.toString().replace(/-/gi,"")}`:e.currentTarget.id===StartH||e.currentTarget.id===EndH?e.currentTarget.value=t<24?1===t.toString().length?`0${t}`:t:"23":e.currentTarget.value=t<60?1===t.toString().length?`0${t}`:t:"59":e.currentTarget.value="00",e.currentTarget.id!==StartH&&e.currentTarget.id!==StartM&&e.currentTarget.id!==StartS||validateStartEndTime1(!1)&&(_isStartTimeChange1=!0,_vidTag1.currentTime=startTimeToSecond1()),e.currentTarget.id!==EndH&&e.currentTarget.id!==EndM&&e.currentTarget.id!==EndS||validateStartEndTime1(!1)&&(_isEndTimeChange1=!0,_vidTag1.currentTime=endTimeToSecond1())}function mouseDownSliderLeft1(){console.log("Allow moving left slider"),_isSlideLeft1=!0,_isSlide1=!0}function mouseDownSliderRight1(){console.log("Allow moving right slider"),_isSlideRight1=!0,_isSlide1=!0}function oneSecondToPx1(e){return e/document.getElementById(VdProcess1).duration}function getCurrentTime1(e){const t=e/_sliderWrap1.getBoundingClientRect().width*100,n=document.getElementById(VdProcess1).duration;return t.toFixed(2)/100*n}function mouseMove1(e){const t=_sliderWrap1.getBoundingClientRect(),n=_circleSlider1.getBoundingClientRect();if(e.clientX>=t.left-n.width/2&&e.clientX<=t.width+t.left+n.width/2){const n=(e.clientX-t.left)/t.width*100,o=_sliderLeft1.getBoundingClientRect(),i=_sliderRight1.getBoundingClientRect();if(!_isSlide1||_isSlideLeft1||_isSlideRight1||(_circleSlider1.style.left=`${n}%`),_isSlideLeft1)if(i.x+i.width/2-e.clientX>oneSecondToPx1(t.width)){_isMsgBoxShow1=!1,_msgBox1.style.display="none",_sliderLeft1.style.left=`${n}%`,spSplitBar1.style.left=`${n}%`;const e=_sliderWrap1.clientWidth,t=(i.x-o.x)/e*100;spSplitBar1.style.width=`${t}%`,_circleSlider1.style.left=`${n}%`}else _isMsgBoxShow1=!0,_msgBox1.style.display="block";if(_isSlideRight1)if(e.clientX-(o.x+o.width/2)>oneSecondToPx1(t.width)){_isMsgBoxShow1=!0,_msgBox1.style.display="none",_sliderRight1.style.left=`${n}%`;const e=_sliderWrap1.clientWidth,t=(i.x-o.x)/e*100;spSplitBar1.style.width=`${t}%`,_circleSlider1.style.left=`${n}%`}else _msgBox1.style.display="block";if(_isSlide1){console.log("moving current slider");const e=_circleSlider1.style.left.replace(/%/gi,"")/100*_vidTag1.duration;document.getElementById(VdProcess1).currentTime=e}}}function mouseUp1(){_isSlide1&&(_isSlide1=!1),_isSlideLeft1&&(_isSlideLeft1=!1),_isSlideRight1&&(_isSlideRight1=!1)}function mouseDownCurrentSlider1(){_isSlide1=!0}function ontimeUpdate1(e){const t=new Date(1e3*e.currentTarget.currentTime).toISOString(),n=e.currentTarget.currentTime/e.currentTarget.duration*100;if(document.getElementById(SpCurentTime1).innerHTML=t.substr(11,8),_circleSlider1.style.left=`${n}%`,console.log("timePercent"),console.log(n),_isSlideLeft1){_sliderLeft1.style.left=`${n}%`,spSplitBar1.style.left=`${n}%`,_startH1.value=t.substr(11,2),_startM1.value=t.substr(14,2),_startS1.value=t.substr(17,2);const e=_sliderLeft1.getBoundingClientRect(),o=_sliderRight1.getBoundingClientRect(),i=_sliderWrap1.clientWidth,l=(o.x-e.x)/i*100;spSplitBar1.style.width=`${l}%`}if(_isSlideRight1){_sliderRight1.style.left=`${n}%`,_endH1.value=t.substr(11,2),_endM1.value=t.substr(14,2),_endS1.value=t.substr(17,2);const e=_sliderLeft1.getBoundingClientRect(),o=_sliderRight1.getBoundingClientRect();spSplitBar1.style.width=`${o.x-e.x}px`;const i=_sliderWrap1.clientWidth,l=(o.x-e.x)/i*100;spSplitBar1.style.width=`${l}%`}if(_isStartTimeChange1){_isStartTimeChange1=!1,_sliderLeft1.style.left=`${n}%`,spSplitBar1.style.left=`${n}%`;const e=_sliderLeft1.getBoundingClientRect(),t=_sliderRight1.getBoundingClientRect(),o=_sliderWrap1.clientWidth,i=(t.x-e.x)/o*100;spSplitBar1.style.width=`${i}%`}if(_isEndTimeChange1){_isEndTimeChange1=!1,_sliderRight1.style.left=`${n}%`;const e=_sliderLeft1.getBoundingClientRect(),t=_sliderRight1.getBoundingClientRect(),o=_sliderWrap1.clientWidth,i=(t.x-e.x)/o*100;spSplitBar1.style.width=`${i}%`}}function playVideo1(e){e.currentTarget.classList.toggle("n-video-pause");const t=document.getElementById(VdProcess1);t.paused?t.play():t.pause()}function ClearAllVideoInfo1(){console.log("Clearing all video information."),_videoOpdts1=[],_splitVideo1=[],_partVideo1=0,colorIndex1=0,document.getElementById(VdProcess1).src="",document.getElementById(DivVideoTag1).style.cssText="display:none !important",document.getElementById(DivLoadVideo1).style.cssText="display:flex !important",document.getElementById(InputUploadVideo1).value="",_divVideoThumbnail.innerHTML="",document.getElementById(DivProcessVideo1).style.cssText="display:none !important",document.getElementById(DivBarPart1).innerHTML="",_divVideoRightList1.style.display="none",_appElement&&angular.element(_appElement).scope()&&angular.element(_appElement).scope().$$phase&&angular.element(_appElement).scope().$apply(()=>{angular.element(_appElement).scope().SplitVideoUrl="",angular.element(_appElement).scope().selectedVideo={}}),_txtCropSec1.value=60}function closeVdPreview1(){ConfirmYesNo("Confirmation","Are you sure to cancel this video?",()=>{ClearAllVideoInfo1()},()=>{})}function dragOverDivVideo1(e){e.target.style.backgroundColor="dodgerblue",e.target.style.borderColor="#fff",e.target.style.color="white",e.dataTransfer.setData("text/plain",e.target.id),console.log(e.currentTarget.files)}function dropDivVideo1(e){const t=e.dataTransfer.getData("text/plain");console.log(t),console.log(e.currentTarget.files)}function setDefaultSplitTime1(e){const t=new Date(e/100*_sliderLeft1.style.left.replace(/%/gi,"")*1e3).toISOString(),n=new Date(e/100*_sliderRight1.style.left.replace(/%/gi,"")*1e3).toISOString();_startH1.value=t.substr(11,2),_startM1.value=t.substr(14,2),_startS1.value=t.substr(17,2),_endH1.value=n.substr(11,2),_endM1.value=n.substr(14,2),_endS1.value=n.substr(17,2)}function posSplitControlsByDefaultSecond1(){const e=_txtCropSec1.value;if(parseInt(e)<1)MsgInform("Error","Invalid default second!","error",!1,!0);else{let t=e/_vidTag1.duration*100;console.log(t),t=t>100?100:t,console.log(t),_sliderLeft1.style.left="0%",spSplitBar1.style.left="0%",_circleSlider1.style.left="0%",_sliderRight1.style.left=`${t}%`;const n=_sliderLeft1.getBoundingClientRect(),o=_sliderRight1.getBoundingClientRect(),i=_sliderWrap1.clientWidth,l=(o.x-n.x)/i*100;spSplitBar1.style.width=`${l}%`,console.log(i),console.log(l)}}function onChangedInputVf1(e){console.log("Video file has been changed.");const t=document.getElementById(AVdPlay1);if(t.classList.remove("n-video-pause"),t.classList.add("n-video-preview"),console.log(e.currentTarget.files),0===e.currentTarget.files.length)return;const n=URL.createObjectURL(e.currentTarget.files[0]),o=document.getElementById(VdProcess1);o.src=n,_currentVideoSrc1=URL.createObjectURL(e.currentTarget.files[0]),o.onloadeddata=(()=>{if(console.log(o.duration),o.duration>86400)console.log("The video is too long.");else{const e=new Date(1e3*o.duration).toISOString().substr(11,8);document.getElementById(SpTotalTime1).innerHTML=e,console.log(e),posSplitControlsByDefaultSecond1(),setDefaultSplitTime1(o.duration)}}),console.log(e.currentTarget.files[0]),document.getElementById(DivVideoTag1).style.cssText="display:block !important",document.getElementById(DivLoadVideo1).style.cssText="display:none !important"}class OpMaster extends StyleMaster{constructor(e,t,n,o,i){super(e,t,n,o),this.OpRevNo=i}}class VideoOpdt extends OpMaster{constructor(e,t,n,o,i,l,d,r,a,s,p,c,u,m){super(t,n,o,i,l),this.Edition=e,this.OpSerial=d,this.StartTime=r,this.EndTime=a,this.PartNo=s,this.DisplayName=p,this.TotalTime=c,this.TotalTimeStr=u,this.BarBgColor=m}}class SplitControl extends VideoOpdt{constructor(e,t,n,o,i,l,d,r,a,s,p,c,u,m,g,S,v,_,f){super(e,t,n,o,i,l,d,r,a,s,p,c,u,m),this.StartedSplittingLeft=g,this.EndedSplittingLeft=S,this.SplittingBarWidth=v,this.StartedDuration=_,this.ThumbnailImage=f}}